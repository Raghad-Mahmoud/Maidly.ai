<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="utf-8">
  <meta content="width=device-width, initial-scale=1.0" name="viewport">
  <title>Mindly.ai</title>
  <meta name="description" content="">
  <meta name="keywords" content="">
  <!-- Favicons -->
  <link href="static/img/favicon.png" rel="icon">
  <link href="static/img/apple-touch-icon.png" rel="apple-touch-icon">
  <!-- Fonts -->
  <link href="https://fonts.googleapis.com" rel="preconnect">
  <link href="https://fonts.gstatic.com" rel="preconnect" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Roboto:ital,wght@0,100;0,300;0,400;0,500;0,700;0,900;1,100;1,300;1,400;1,500;1,700;1,900&family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&display=swap"
    rel="stylesheet">
  <!-- Vendor CSS Files -->
  <link href="static/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="static/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="static/vendor/aos/aos.css" rel="stylesheet">
  <link href="static/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">
  <link href="static/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
  <!-- Main CSS File -->
  <link href="static/css/main.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.1/css/all.min.css">
  <link rel="stylesheet" href="../static/css/flash-message.css">

  <script src="static/js/export-mindmap.js"></script>
  <script src="static/js/handling_summ_req.js"></script>
  <script src="static/js/handling_regenerate_summ_req.js"></script>
  <script src="static/js/display-file-name.js"></script>
  <script>
    const appUrl = '{{ config.APP_URL }}';
  </script>
  <script src="../static/js/mind-map-views.js"></script>


</head>

<body class="index-page">
  <!-- mind map page navbar -->
  <nav class="navbar navbar-expand-lg py-3 ">
    <div class="pe-lg-0 ps-lg-5 container-fluid justify-content-between">
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent"
        aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse justify-content-between " id="navbar-supported-content">
        <div class="nav_left  d-lg-flex align-items-center">
          <nav class="main-nav">
            <div class="nav d-block d-lg-flex nav-tabs" id="nav-tab" role="tablist">
              <div class="left">
                <a href="/">
                  <p class="website-name">Mindly.ai</p>
                </a>
              </div>
              <a href="/"><i title="Home" class="bi bi-house-fill nav-link" id="home-icon"></i></a>
              <a href="/"><i title="Profile" class="bi bi-person-circle nav-link" id="profile-icon"></i></a>
            </div>
          </nav>
        </div>
      </div>

      <div class="collapse navbar-collapse justify-content-end " id="navbar-supported-content">
        <div class="nav_right d-lg-flex align-items-center">
          <nav class="sub-nav">
            <div class="nav d-block d-lg-flex nav-tabs" id="nav-tab" role="tablist">
              <label for="upload-file-btn">
                <i title="Upload PDF" class="bi bi-file-pdf-fill nav-link" id="upload-icon"></i>
                <p class="file-name" id="file-name"></p>
              </label>
              <form action="http://127.0.0.1:5000/generate-mind-map" method="POST" enctype="multipart/form-data">
                <input class="nav-link" type="file" name="document" id="upload-file-btn" onchange="displayFileName()">
                <button title="Submit to generate" type="submit" class="nav-link">
                  <i class="bi bi-file-check-fill" id="submit-icon"></i>
                </button>
              </form>
              <i title="Export as image" class="bi bi-upload nav-link" id="export-as-image-button"></i>
              <i title="Share" class="bi bi-share-fill nav-link" id="share-icon"></i>
            </div>
          </nav>
        </div>
      </div>
    </div>
  </nav>
  <main class="main">
    <!-- button section -->
    <!-- /button section -->
    <!-- Mind Map -->
    <div>
      <button id="firstView">Default View</button>
      <button id="secondView">Mind Map View</button>
      <button id="thirdView">Class Hierarchy View</button>
    </div>

    <div id="mind"></div>

    <!-- import the GO JS inorder to display our Mind Map -->
    <script src="https://unpkg.com/gojs/release/go-debug.js"></script>

    <!-- Popup Modal -->
    <div id="popup" class="popup-container">
      <div class="popup-content">
        <div id="summarization-image-loading-spinner" class="spinner-border m-5 align-self-center" role="status">
          <span class="sr-only"></span>
        </div>
        <span id="closeModalIcon" class="close-icon">&times;</span>
        <div class="popup-image" id="summarization-image-container">
          <img alt="Ai generated image" id="summarization-image">
        </div>
        <div class="popup-text">
          <h2 class="popup-title" id="popup__title">Welcome to Our Service</h2>
          <div id="modal-content">
            <p id="popupExplanation" class="popup-explanation">

            </p>
          </div>
          <div class="popup-buttons">
            <div class="modal-footer">
              <button id="btn-regenerate" class="btn btn-regenerate"
                onclick="regenerateSummarizationContent(`{{ config.APP_URL }}`)">Regenerate</button>
            </div>
          </div>
        </div>
      </div>
    </div>

    <div>
      <ul class="notifications" id="flash-messages-container"></ul>
    </div>

    <script src="https://unpkg.com/gojs/release/go-debug.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      let summarizationImageLoadingSpinner = document.getElementById('summarization-image-loading-spinner');
      let summarizationImageContainer = document.getElementById('summarization-image-container');
      const popupModal = document.getElementById('popup');
      const closeModalIcon = document.getElementById('closeModalIcon');
      popupModal.classList.remove('active');

      // Close Modal Event
      closeModalIcon.addEventListener('click', () => {
        popupModal.classList.remove('active');
      });

      function generate_subtopic_window(subtopic, obj) {
        const nodeData = obj.part.data;

        document.getElementById('popup__title').innerText = nodeData.name;

        popupModal.classList.add('active');
        summarizationImageLoadingSpinner.classList.remove('d-none');
        summarizationImageContainer.classList.add('d-none');
        handleGenerateSummarizationImage(subtopic, '{{ config.APP_URL }}');
      }


      // Define a color mapping function
      function getColorForKey(key) {
        const colors = ['#f1916d', '#473e66', '#bd83b8', '#f5d7db'];
        return colors[parseInt(key) % colors.length];
      }

      {% if output %}
      const output = {{ output | tojson }};
      applyFirstView();
      {% else %}
      // If there is no output, apply the static model
      const staticModel = {{ static | tojson }};
      initializeFirstView(staticModel);
      {% endif %}

    </script>
    <script>
      // Initialize the export functionality
      exportMindmap('mind', 'export-as-image-button');
    </script>
    <script>
      // Trigger the modal automatically when the page loads
      //var introduction_popup = new bootstrap.Modal(document.getElementById('introduction_popup'));
      //introduction_popup.show();
    </script>

<script>
  document.addEventListener('DOMContentLoaded', () => {
      document.getElementById('submit-icon').addEventListener('click', async function() {
          try {
              const response = await fetch('/generate-mind-map', {
                  method: 'POST',
                  credentials: 'include'  // Ensure cookies are sent with the request
              });
  
              if (response.status === 401) {
                  // Redirect to login page if unauthorized
                  window.location.href = '/signin';
              } else if (response.redirected) {
                  // Handle any other redirection
                  window.location.href = response.url;
              } 
          } catch (error) {
              console.error('Error:', error);
          }
      });
  });
      </script>
    <!-- /Mind Map -->
  </main>
  <!-- Scroll Top -->
  <a href="#" id="scroll-top" class="scroll-top d-flex align-items-center justify-content-center"><i
      class="bi bi-arrow-up-short"></i></a>
  <!-- Preloader -->
  <!-- <div id="preloader"></div> -->
  <!-- Vendor JS Files -->
  <script src="static/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="static/vendor/php-email-form/validate.js"></script>
  <script src="static/vendor/aos/aos.js"></script>
  <script src="static/vendor/swiper/swiper-bundle.min.js"></script>
  <script src="static/vendor/purecounter/purecounter_vanilla.js"></script>
  <script src="static/vendor/glightbox/js/glightbox.min.js"></script>
  <script src="static/vendor/imagesloaded/imagesloaded.pkgd.min.js"></script>
  <script src="static/vendor/isotope-layout/isotope.pkgd.min.js"></script>
  <!-- Main JS File -->
  <script src="static/js/main.js"></script>
  <script src="static/js/flash-message.js"></script>
  <script src="static/js/generating-summarization-image-handler.js"></script>
</body>

</html>